<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Fes una donació per exigir a Espanya que investigui i jutgi els crims del franquisme. Mai és tard, però ha de ser ara.">
    <meta name="keywords" content="donacio, justícia franquista, crims franquisme, drets humans, TEDH, ONU, querella, repressió franquista">
    <meta name="author" content="Justícia Antifranquista">
    <meta property="og:title" content="Fes una donació per exigir justícia pels crims del Franquisme">
    <meta property="og:description" content="Un centenar de persones represaliades han escrit una carta al TEDH i a l'ONU. Signa tu també la carta.">
    <meta property="og:image" content="https://justiciaantifranquista.org/assets/baner_crimsfranquisme.jpg">
    <meta property="og:url" content="https://justiciaantifranquista.org">
    <meta property="og:type" content="website">
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="He signat per exigir justícia pels crims del Franquisme">
    <meta name="twitter:description" content="Signa la carta al TEDH i a l'ONU perquè Espanya investigui els crims del franquisme.">
    <meta name="twitter:image" content="https://justiciaantifranquista.org/assets/baner_crimsfranquisme.jpg">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <title data-i18n="titol">Justícia Antifranquista</title>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&display=swap" rel="stylesheet">
    <link rel="icon" type="image/png" href="assets/favicon.png">

</head>
<body>
<div class="page-wrapper">
    <header class="header-image" id="header-image"><img src="/assets/baner_crimsfranquisme.jpg" alt="Banner" />
    </header>    
        <nav class="navbar">
            <div class="nav-container">
                <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#signa" class="nav-link" data-i18n="index1" data-i18n-link="true">Dona-hi suport</a>
                </li>
                <li class="nav-item">
                    <a href="#comparteix" class="nav-link" data-i18n="index2" data-i18n-link="true">Comparteix</a>
                </li>
                <li class="nav-item">
                    <a href="/donacio.html" class="nav-link" data-i18n="index3" data-i18n-link="true">Fes un donatiu</a>
                </li>
            </ul>
                <div class="language-selector">
                    <a href="#" onclick="changeLanguage('cat')">CAT</a>
                    <span class="language-separator">|</span>
                    <a href="#" onclick="changeLanguage('eusk')">EUSK</a>
                    <span class="language-separator">|</span>
                    <a href="#" onclick="changeLanguage('es')">ES</a>
                    <span class="language-separator">|</span> 
                    <a href="#" onclick="changeLanguage('engl')">ENGL</a>
                </div>
                
            </div>
        </nav>

    <form action="https://sinergia.iridia.cat/index.php?entryPoint=stic_Web_Forms_save" name="WebToLeadForm" method="POST" id="WebToLeadForm" >
        <p>
        <input type="hidden" id="event_id" name="event_id" value="80d960e0-41e0-61ec-b1fe-667521b778ff" />
        <input type="hidden" id="redirect_url" name="redirect_url" value="https://justiciaantifranquista.org/gracies" />
        <input type="hidden" id="redirect_ko_url" name="redirect_ko_url" value="https://justiciaantifranquista.org/error" />
        <input type="hidden" id="validate_identification_number" name="validate_identification_number" value="1" />
        <input type="hidden" id="assigned_user_id" name="assigned_user_id" value="1" />
        <input type="hidden" id="req_id" name="req_id" value="Contacts___first_name;Contacts___last_name;Contacts___stic_identification_number_c;Contacts___email1;stic_Payment_Commitments___amount;Contacts___consentiment_c;" />
        <input type="hidden" id="webFormClass" name="webFormClass" value="EventInscription" />
        <input type="hidden" id="stic_Payment_Commitments___payment_type" name="stic_Payment_Commitments___payment_type" value="donation" />
        <input type="hidden" id="stic_Payment_Commitments___periodicity" name="stic_Payment_Commitments___periodicity" value="punctual" />
        <input type="hidden" id="stic_Payment_Commitments___amount" name="stic_Payment_Commitments___amount" value="">
        <input type="hidden" id="stic_Payment_Commitments___payment_method" name="stic_Payment_Commitments___payment_method" value="stripe_donacions" />
        <input type="hidden" id="stic_Registrations___campanya_firma_c" name="stic_Registrations___campanya_firma_c" value="TEDH" />
        <input type="hidden" id="Contacts___stic_identification_type_c" name="Contacts___stic_identification_type_c" value="" />
        <input type="hidden" id="bool_id" name="bool_id" value="Contacts___consentiment_c;" />
        <input type="hidden" id="language" name="language" value="ca_ES" />
        <input type="hidden" id="defParams" name="defParams" value="%7B%22include_payment_commitment%22%3A1%2C%22include_organization%22%3A0%2C%22account_code_mandatory%22%3A0%2C%22include_registration%22%3A1%2C%22account_name_optional%22%3A0%2C%22email_template_id%22%3A%22%22%2C%22include_recaptcha%22%3A0%2C%22recaptcha_configs%22%3A%7B%22%28General%29%22%3A%7B%22KEY%22%3A%226LetnWUiAAAAAI8skRzN2KQCZpzMQ2gfoS0_PSUw%22%2C%22NAME%22%3A%22%22%2C%22WEBKEY%22%3A%226LetnWUiAAAAABca1-D5HFbILH7B31RfD98TX-LE%22%2C%22VERSION%22%3A%222%22%7D%7D%2C%22recaptcha_configKeys%22%3A%5B%22%28General%29%22%5D%2C%22recaptcha_selected%22%3A%220%22%7D" />
        <input type="hidden" id="timeZone" name="timeZone" value="" />
        
    <section id="signa" class="form-section">
        <h2 data-i18n="boto-donacio">FES UNA DONACIÓ</h2>
        <p style="margin-top:10px;" data-i18n="text-donacio1">La teva donació desgrava! Aporta per col·laborar en la presentació de les demandes al Tribunal Europeu i a les Nacions Unides. El cost total previst és de <strong>42.500€</strong>, el teu suport és essencial!</p>
        <p style="margin-top:10px;" data-i18n="text-donacio2">Si vols fer una donació a través de <strong>Bizum</strong>, a la teva app ves a l’opció “donar suport a una causa solidària o ONG” i indica el número «09704». Per poder desgravar l'aportació feta per Bizum contacta'ns a info@justiciaantifranquista.org</p>
        <div class="form-grid" style="margin-top:20px;">
            <div class="form-group"><input id="Contacts___first_name" class="form-input" name="Contacts___first_name" type="text" placeholder="Nom*" data-i18n-placeholder="placeholder2" required></div>
            <div class="form-group"><input id="Contacts___last_name" class="form-input" name="Contacts___last_name" type="text" placeholder="Cognoms*" data-i18n-placeholder="placeholder3" required></div>
            <div class="form-group"><input id="Contacts___stic_identification_number_c" class="form-input" name="Contacts___stic_identification_number_c" type="text" placeholder="DNI/NIE*" onchange="validateDniField(this);" required></div>
            <div class="form-group">
                <select id="Contacts___primary_address_state" name="Contacts___primary_address_state" class="form-input" style="color: #999;">
                    <option label="" value="" data-i18n="provincia-select">Selecciona la província*</option>
                    <option label="Albacete" value="02" data-i18n="provincia-albacete">Albacete</option>
                    <option label="Alacant" value="03" data-i18n="provincia-alacant">Alacant</option>
                    <option label="Almeria" value="04" data-i18n="provincia-almeria">Almeria</option>
                    <option label="Àlaba" value="01" data-i18n="provincia-alaba">Àlaba</option>
                    <option label="Astúries" value="33" data-i18n="provincia-asturies">Astúries</option>
                    <option label="Àvila" value="05" data-i18n="provincia-avila">Àvila</option>
                    <option label="Badajoz" value="06" data-i18n="provincia-badajoz">Badajoz</option>
                    <option label="Illes Balears" value="07" data-i18n="provincia-balears">Illes Balears</option>
                    <option label="Barcelona" value="08" data-i18n="provincia-barcelona">Barcelona</option>
                    <option label="Biscaia" value="48" data-i18n="provincia-biscaia">Biscaia</option>
                    <option label="Burgos" value="09" data-i18n="provincia-burgos">Burgos</option>
                    <option label="Càceres" value="10" data-i18n="provincia-caceres">Càceres</option>
                    <option label="Cadis" value="11" data-i18n="provincia-cadis">Cadis</option>
                    <option label="Cantàbria" value="39" data-i18n="provincia-cantabria">Cantàbria</option>
                    <option label="Castelló de la Plana" value="12" data-i18n="provincia-castello">Castelló de la Plana</option>
                    <option label="Ceuta" value="51" data-i18n="provincia-ceuta">Ceuta</option>
                    <option label="Ciudad Real" value="13" data-i18n="provincia-ciudadreal">Ciudad Real</option>
                    <option label="Còrdova" value="14" data-i18n="provincia-cordova">Còrdova</option>
                    <option label="Corunya, la" value="15" data-i18n="provincia-corunya">Corunya, la</option>
                    <option label="Conca" value="16" data-i18n="provincia-conca">Conca</option>
                    <option label="Guipúscoa" value="20" data-i18n="provincia-guipuscoa">Guipúscoa</option>
                    <option label="Girona" value="17" data-i18n="provincia-girona">Girona</option>
                    <option label="Granada" value="18" data-i18n="provincia-granada">Granada</option>
                    <option label="Guadalajara" value="19" data-i18n="provincia-guadalajara">Guadalajara</option>
                    <option label="Huelva" value="21" data-i18n="provincia-huelva">Huelva</option>
                    <option label="Osca" value="22" data-i18n="provincia-osca">Osca</option>
                    <option label="Jaén" value="23" data-i18n="provincia-jaen">Jaén</option>
                    <option label="Lleó" value="24" data-i18n="provincia-lleo">Lleó</option>
                    <option label="Lleida" value="25" data-i18n="provincia-lleida">Lleida</option>
                    <option label="Lugo" value="27" data-i18n="provincia-lugo">Lugo</option>
                    <option label="Madrid" value="28" data-i18n="provincia-madrid">Madrid</option>
                    <option label="Màlaga" value="29" data-i18n="provincia-malaga">Màlaga</option>
                    <option label="Melilla" value="52" data-i18n="provincia-melilla">Melilla</option>
                    <option label="Múrcia" value="30" data-i18n="provincia-murcia">Múrcia</option>
                    <option label="Navarra" value="31" data-i18n="provincia-navarra">Navarra</option>
                    <option label="Ourense" value="32" data-i18n="provincia-ourense">Ourense</option>
                    <option label="Palència" value="34" data-i18n="provincia-palencia">Palència</option>
                    <option label="Palmas, Las" value="35" data-i18n="provincia-palmas">Palmas, Las</option>
                    <option label="Pontevedra" value="36" data-i18n="provincia-pontevedra">Pontevedra</option>
                    <option label="Rioja, La" value="26" data-i18n="provincia-rioja">Rioja, La</option>
                    <option label="Salamanca" value="37" data-i18n="provincia-salamanca">Salamanca</option>
                    <option label="Santa Cruz de Tenerife" value="38" data-i18n="provincia-santacruz">Santa Cruz de Tenerife</option>
                    <option label="Segòvia" value="40" data-i18n="provincia-segovia">Segòvia</option>
                    <option label="Sevilla" value="41" data-i18n="provincia-sevilla">Sevilla</option>
                    <option label="Sòria" value="42" data-i18n="provincia-soria">Sòria</option>
                    <option label="Tarragona" value="43" data-i18n="provincia-tarragona">Tarragona</option>
                    <option label="Terol" value="44" data-i18n="provincia-terol">Terol</option>
                    <option label="Toledo" value="45" data-i18n="provincia-toledo">Toledo</option>
                    <option label="València" value="46" data-i18n="provincia-valencia">València</option>
                    <option label="Valladolid" value="47" data-i18n="provincia-valladolid">Valladolid</option>
                    <option label="Zamora" value="49" data-i18n="provincia-zamora">Zamora</option>
                    <option label="Saragossa" value="50" data-i18n="provincia-saragossa">Saragossa</option>
                    <option label="No residents" value="99" data-i18n="provincia-noresidents">No residents</option>
                </select></div>
            <div class="form-group"><input id="Contacts___email1" class="form-input" name="Contacts___email1" type="text" placeholder="Correu electrònic*" onchange="validateEmailAdd(this);" data-i18n-placeholder="placeholder4" required></div>
            <div class="form-group"><input id="Contacts___phone_mobile" class="form-input" name="Contacts___phone_mobile" type="text" placeholder="Mòbil*" data-i18n-placeholder="placeholder5" required></div>
        </div>
        
        <div class="amount-buttons" style="display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; margin-bottom: 20px;">
            <button type="button" class="btn amount-btn" data-amount="20">20 €</button>
            <button type="button" class="btn amount-btn" data-amount="50">50 €</button>
            <button type="button" class="btn amount-btn" data-amount="100">100 €</button>
            <button type="button" class="btn amount-btn" data-amount="200">200 €</button>
            <div class="btn custom-amount-wrapper" contenteditable="true" id="custom-amount" data-placeholder="altres valors" data-i18n-placeholder="placeholder6" data-showing-placeholder="true"></div>
            </div>

                <label class="consent-label" id="consent-label" data-i18n="text-donacio3">T’informem que l’Associació Irídia, responsable del tractament de les dades que ens facilitis, amb correu info@iridia.cat i telèfon 693 563 529, tractem les teves dades amb finalitat comunicativa i de gestió de la donació, et contactarem per informació de l'entitat, actes i campanyes que realitzem. Consulta la política <a href="/politica-privacitat.html" target="_blank" rel="noopener">aquí</a>.</label>
                <div class="checkbox-group">
                    <label class="custom-checkbox">
                        <input type="checkbox" id="Contacts___consentiment_c" name="Contacts___consentiment_c" required>
                        <span class="checkmark"></span>
                        <span class="checkbox-label-text" id="consent-text" for="Contacts___consentiment_c" for="consent" data-i18n="signa5">Accepto el tractament *</span>
                    </label>
                    
                </div>
                <div class="cf-turnstile" data-sitekey="0x4AAAAAABgvZbG5L-aBdqvF"></div>
                <input type="hidden" id="cf-turnstile-token" name="cf-turnstile-response">
                <button type="button" class="btn" onclick="submitForm(document.forms[0])" data-i18n="signa6">Enviar</button>
    </section>
    </form>

    <section class="text-centered">
        <h2 data-i18n="titol-comparteix">COMPARTEIX LA CAMPANYA</h2>
        <div class="share-buttons">
            <div class="share-buttons" data-i18n="botons-comparteix">
                <a class="share-btn whatsapp" id="share-whatsapp" target="_blank" rel="noopener"><i class="fab fa-whatsapp"></i></a>
                <a class="share-btn telegram" id="share-telegram" target="_blank" rel="noopener"><i class="fab fa-telegram-plane"></i></a>
                <a class="share-btn twitter" id="share-twitter" target="_blank" rel="noopener"><i class="fab fa-x-twitter"></i></a>
                <a class="share-btn facebook" id="share-facebook" target="_blank" rel="noopener"><i class="fab fa-facebook-f"></i></a>
                <a class="share-btn linkedin" id="share-linkedin" target="_blank" rel="noopener"><i class="fab fa-linkedin-in"></i></a>
            </div>
    </section>

    <div class="separator-line"></div>

        <section class="text-centered">   
            <div style="text-align: center;">
                <div style="text-align: center;">
                    
                        <a href="/index.html" class="nav-link" style="text-align: center;" data-i18n="torna">Torna a la pàgina principal de la campanya</a>
                    
                </div>       
            </div>     
        </section>

</div>
    <footer class="footer">
        <section class="text-centered-spacious">
            <p><a href="/avis-legal.html" data-i18n-link="true" data-i18n="footer1">Avís Legal</a> | <a href="/politica-privacitat.html" data-i18n-link="true" data-i18n="footer2">Política de privadesa</a></p>
        </section>
    </footer>

    <script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>
<script src="js/stript-traduccions.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", function () {
      const accordionHeaders = document.querySelectorAll('.accordion-header');

      accordionHeaders.forEach(header => {
          header.addEventListener('click', function (e) {
              e.preventDefault();

              const content = this.nextElementSibling;
              const isActive = this.classList.contains('active');

              accordionHeaders.forEach(h => {
                  if (h !== this) {
                      h.classList.remove('active');
                      const sibling = h.nextElementSibling;
                      if (sibling) {
                          sibling.style.maxHeight = null;
                          sibling.classList.remove('active');
                      }
                  }
              });

              if (isActive) {
                  this.classList.remove('active');
                  content.style.maxHeight = null;
                  content.classList.remove('active');
              } else {
                  this.classList.add('active');
                  content.classList.add('active');
                  content.style.maxHeight = (content.scrollHeight + 40) + "px";
              }
          });
      });
  });

      var stic_Web_Forms_LBL_PROVIDE_WEB_FORM_FIELDS = "Ompliu els camps obligatoris";
    var stic_Web_Forms_LBL_INVALID_FORMAT = "Comproveu el format del camp";
    var stic_Web_Forms_LBL_SERVER_CONNECTION_ERROR = "Ha fallat la connexió amb el servidor";
    var stic_Web_Forms_LBL_SIZE_FILE_EXCEED = "La mida del fitxer no pot ser superior a ";
    var stic_Web_Forms_LBL_SUM_SIZE_FILES_EXCEED = "La suma de les mides dels fitxers no pot ser superior a ";
    var APP_LBL_REQUIRED_SYMBOL = "*";
    var APP_DATE_FORMAT = "%d/%m/%Y";
    var stic_Payment_Commitments_LBL_IBAN_NOT_VALID = "LBL_IBAN_NOT_VALID";
    /**
     * Change the visibility of a field
     * @param field field to be changed
     * @param visibility visibility applied to the field
     */

    function changeVisibility(field, visibility) {
        var o_td = document.getElementById("td_" + field);
        var o_td_lbl = document.getElementById("td_lbl_" + field);
        if (o_td) {
            o_td.style.display = visibility;
        }

        if (o_td_lbl) {
            o_td_lbl.style.display = visibility;
        }
    }

    /**
     * Show a hidden field
     * @param field field to be shown
     */
    function showField(field) {
        changeVisibility(field, "table-cell");
    }

    /**
     * Hide a field
     * @param field field to be hidden
     */
    function hideField(field) {
        changeVisibility(field, "none");
    }

    // STIC-custom 20211122 - jch - Avoid multiple submission
    // https://github.com/SinergiaTIC/SinergiaCRM-SuiteCRM/pull/489
    var formHasAlreadyBeenSent = false;
    /**

    /**
     * Add a field as required
     * @param field field that will be set as required
     */
    function addRequired(field) {
        var reqs = document.getElementById("req_id").value;
        if (-1 == reqs.search(field + ";")) {
            document.getElementById("req_id").value += field + ";";
        }

        var requiredLabel = document.getElementById("lbl_" + field + "_required");
        if (!requiredLabel) {
            var rlParent = document.getElementById("td_lbl_" + field);
            if (rlParent) {
                var newLabel = document.createElement("span");
                newLabel.id = "lbl_" + field + "_required";
                newLabel.class = "required";
                newLabel.style = "color: rgb(175, 238, 238);";
                newLabel.innerText = APP_LBL_REQUIRED_SYMBOL;
                rlParent.appendChild(newLabel);
            }
        }
    }

    /**
     * Delete a field as required
     * @param field field that will be set as no required
     */
    function removeRequired(field) {
        var reqs = document.getElementById("req_id").value;
        document.getElementById("req_id").value = reqs.replace(field + ";", "");
        var requiredLabel = document.getElementById("lbl_" + field + "_required");
        if (requiredLabel) {
            requiredLabel.parentNode.removeChild(requiredLabel);
        }
    }

    /**
     * Validate different form fields
     * @returns {Boolean}
     */

     function checkFields() {
            if (!validateRequired() || !validateNifCif() || !validateMails() || !validateDates()) {
                return false;
            }

            var boolHidden = document.getElementById("bool_id");
            if (boolHidden != null) {
                var reqs = boolHidden.value;
                if (reqs.length) {
                    var bools = reqs.substring(0, reqs.lastIndexOf(";"));
                    var boolFields = bools.split(";");
                    for (var i = 0; i < boolFields.length; i++) {
                        var element = document.getElementById(boolFields[i]);
                        if (element) {
                            element.value = (element.checked ? 1 : 0); 
                        }
                    }
                }
            }

            var amountField = document.getElementById("stic_Payment_Commitments___amount");
            if (!amountField) {
                alert("No s'ha trobat el camp import");
                return false;
            }
            if (!amountField.value || isNaN(amountField.value) || Number(amountField.value) <= 0) {
                alert("Cal indicar un import vàlid per fer la donació");
                amountField.focus();
                return false;
            }

            var provinceField = document.getElementById("Contacts___primary_address_state");
            if (!provinceField) {
                alert("No s'ha trobat el camp província");
                return false;
            }
            if (provinceField.value === "") {
                alert("Cal seleccionar una província");
                provinceField.focus();
                return false;
            }

            return true;
        }
    /**
     * Check the format of the date fields
     * @returns {Boolean}
     */
    function validateDates() {
        var elements = $.find("input[type=text].date_input");
        if (elements && elements.length > 0) {
            for (var i = 0; i < elements.length; i++) {
                if (elements[i].value && !validateDate(elements[i].value)) {
                    var label = document.getElementById("lbl_" + elements[i].id);
                    alert(stic_Web_Forms_LBL_INVALID_FORMAT + ": " + label.textContent.trim().replace(/:$/, ""));
                    selectTextInput(elements[i]);
                    return false;
                }
            }
        }
        return true;
    }

    /**
     * Validate a date using the format indicated in APP_DATE_FORMAT. Does not take into account if the year is leap year
     * @param date
     * @returns {Boolean}
     */
    function validateDate(date) {
        var number = /\d+/g;
        var numbers = [];
        var match = number.exec(date);

        while (match != null) {
            numbers.push(match[0]);
            match = number.exec(date);
        }

        if (numbers.length != 3) {
            // If we don't have three numeric fields, it sure isn't a date
            return false;
        }

        var format = /\%Y|\%m|\%d/g;
        var fields = [];
        match = format.exec(APP_DATE_FORMAT); // We separate the fields from the format
        while (match != null) {
            fields.push(match[0]);
            match = format.exec(APP_DATE_FORMAT);
        }

        var idxFields = []; // Index the fields to be able to access them directly
        for (var i = 0; i < fields.length; i++) {
            idxFields[fields[i].replace("%", "")] = i;
        }

        // Retrieve the values ??of each field
        var day = numbers[idxFields.d];
        var month = numbers[idxFields.m];
        var year = numbers[idxFields.Y];

        // Check the length of the fields
        if (month.length != 2 || day.length != 2 || year.length != 4) {
            return false;
        }

        // Check the format of separators
        if (date.replace(number, "") != APP_DATE_FORMAT.replace(format, "")) {
            return false;
        }
        day = parseInt(day);
        month = parseInt(month);
        year = parseInt(year);

        // Check the value of the month and day
        if (month > 12 || month < 1) {
            return false;
        } else {
            if (day < 1) {
                return false;
            }

            switch (month) {
                case 1:
                case 3:
                case 5:
                case 7:
                case 8:
                case 10:
                case 12:
                    return day <= 31;
                case 2:
                    return day <= 29; // Leap years are not taken into account
                case 4:
                case 6:
                case 9:
                case 11:
                    return day <= 30;
            }
        }
    }

    /**
     * Check the required fields
     * @returns {Boolean}
     */
    function validateRequired() {
        // Check the required fields
        var reqHidden = document.getElementById("req_id");
        if (reqHidden != null) {
            var reqs = reqHidden.value;
            if (reqs.length) {
                // If there are required fields check them
                reqs = reqs.substring(0, reqs.lastIndexOf(";"));
                var reqFields = new Array();
                var reqFields = reqs.split(";");
                nbrFields = reqFields.length;

                for (var i = 0; i < nbrFields; i++) {
                    var lbl_element;
                    var element = document.getElementById(reqFields[i]);
                    var error = 0;
                    if (element != null) {
                        lbl_element = "#lbl_" + element.id;
                        $(lbl_element).removeClass("current-required-field");
                        switch (element.type) {
                            case "checkbox":
                                if (element.checked == 0) {
                                    error = 1;
                                }
                                break;

                            case "select-one":
                                if (element.selectedIndex <= 0) {
                                    error = 1;
                                }
                                break;

                            case "select-multiple":
                                let numOptionsSelected = $("select[id='input_selectmultiple'] option:selected").length;
                                if (element.selectedIndex <= 0 && numOptionsSelected <= 1) {
                                    error = 1;
                                }
                                break;

                            default:
                                // Type fields: text, email, password...
                                if (element.value.length <= 0) {
                                    error = 1;
                                }
                        }
                    } else {
                        //radio type fields
                        error = 1;
                        var options = document.getElementsByName(reqFields[i]);

                        lbl_element = "#lbl_" + options[0].name;
                        $(lbl_element).removeClass("current-required-field");

                        options.forEach(function(option) {
                            if (option.checked) {
                                error = 0;
                            }
                        });
                    }

                    if (error) {
                        alert(stic_Web_Forms_LBL_PROVIDE_WEB_FORM_FIELDS);
                        $(lbl_element).addClass("current-required-field");
                        selectTextInput(element);
                        return false;
                    }
                }
            }
        }
        return true;
    }

    /**
     * Validate form emails
     * @returns {Boolean}
     */
    function validateMails() {
        var fields = ["Contacts___email1", "Contacts___email2", "Accounts___email1", "Accounts___email2"];
        var ret = true;
        for (var i = 0; i < fields.length && ret; i++) {
            emailInput=document.getElementById(fields[i])
            if(emailInput != undefined)
            {
                ret = validateEmailAdd(emailInput);
            }
        }
        return ret;
    }

    /**
     * Validate an email address
     * Regex validation email from https://html5-tutorial.net/form-validation/validating-email/
     * @param obj DOM object of the input containing the mail
     * @returns {Boolean}
     */

    function isValidEmail(email) {
            return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
            }

        function validateEmailAdd(obj) {
        obj.value=obj.value.trim();
        if (obj != null && obj.value.length > 0 && !isValidEmail(obj.value)) {
            alert("Format de correu electrònic no vàlid");
            selectTextInput(obj);
            return false;
        } else {
            return true;
        }
        }



    /**
     * Check the identification number fields for contacts and accounts as needed
     * @returns {Boolean}
     */
    function validateDniField(obj) {
        const dni = obj.value.trim().toUpperCase();
        obj.value = dni;

        if (dni.length === 0) return true; // si està buit, que ho validi més endavant

        const dniRegex = /^[XYZ]?\d{5,8}[A-Z]$/;

        if (!dniRegex.test(dni) || !isValidDNI(dni)) {
            alert("Format de DNI/NIE no vàlid");
            selectTextInput(obj);
            return false;
        }

        return true;
    }

     function validateNifCif() {
        var validateIdentificationNumber = document.getElementById("validate_identification_number");

        // Return true if identification number validation is not required
        if (validateIdentificationNumber && validateIdentificationNumber.value == "0") {
            console.log("Identification number validation is not required.");
            return true;
        }

        // NIF validation
        var identificationType = $("#Contacts___stic_identification_type_c").val();
        // Validate if the stic_identification_type_c field is not defined or is defined as NIF or NIE.
        // Other values like passports and so on should not be validated as there's no rule to do it.
        if (identificationType == null || identificationType == "nif" || identificationType == "nie") {
            var nif = document.getElementById("Contacts___stic_identification_number_c");
            // The nif field may not be required so it can be empty. If so, it is not necessary to validate it
            if (nif && nif.value && !isValidDNI(nif.value)) {
                label = " ";
                if (nif.labels && nif.labels[0]) {
                    label += (nif.labels[0].textContent.slice(-1) == ":" ? nif.labels[0].textContent.substring(0, nif.labels[0].textContent.length - 1) : nif.labels[0].textContent);
                }
                alert(stic_Web_Forms_LBL_INVALID_FORMAT + label + ".");
                nif.focus();
                return false;
            }
        }

        // CIF validation
        var cif = document.getElementById("Accounts___stic_identification_number_c");
        // The cif field may not be required so it can be empty. If so, it is not necessary to validate it
        if (cif && cif.value && !isValidCif(cif.value)) {
            label = " ";
            if (cif.labels && cif.labels[0]) {
                label += (cif.labels[0].textContent.slice(-1) == ":" ? cif.labels[0].textContent.substring(0, cif.labels[0].textContent.length - 1) : cif.labels[0].textContent);
            }
            alert(stic_Web_Forms_LBL_INVALID_FORMAT + label + ".");
            cif.focus();
            return false;
        }

        return true;
    }

    /**
     * Check with each change of value in the field that only number and separator are allowed of decimals '.'
     * @returns {Boolean}
     */
    function isNumberKey(evt) {
        var charCode = evt.which ? evt.which : event.keyCode;
        if (charCode != 46 && charCode > 31 && (charCode < 48 || charCode > 57)) {
            return false;
        }

        if (charCode == 46) {
            var evento = evt || event;
            var dots = evento.currentTarget.value.match(/\./g); // If there is already a point, you cannot add another
            if (dots && dots.length > 0) {
                return false;
            }
            if (evento.currentTarget.value.length == 0) {
                // If the point is at the beginning it includes a 0
                evento.currentTarget.value = "0";
            }
        }

        return true;
    }

    /**
     * Format a value in a number with fixed-point notation
     * @param input currency type field in which to validate the format
     */
    function formatCurrency(input) {
        var value = Number(input.value);
        if (!isNaN(value)) {
            input.value = value.toFixed(2);
        }
    }

    /**
     * Valid if a cif is valid
     * Adapted to javascript from its original in:
     * http://www.michublog.com/informatica/8-funciones-para-la-validacion-de-formularios-con-expresiones-regulares
     * @param cif
     * @returns {Boolean}
     */
    function isValidCif(cif) {
        cif.toUpperCase();
        cifRegEx1 = /^[ABEH][0-9]{8}/i;
        cifRegEx2 = /^[KPQS][0-9]{7}[A-J]/i;
        cifRegEx3 = /^[CDFGJLMNRUVW][0-9]{7}[0-9A-J]/i;

        if (cif.match(cifRegEx1) || cif.match(cifRegEx2) || cif.match(cifRegEx3)) {
            control = cif.charAt(cif.length - 1);
            sum_A = 0;
            sum_B = 0;
            for (i = 1; i < 8; i++) {
                if (i % 2 == 0) {
                    sum_A += parseInt(cif.charAt(i));
                } else {
                    t = (parseInt(cif.charAt(i)) * 2).toString();
                    p = 0;
                    for (j = 0; j < t.length; j++) {
                        p += parseInt(t.charAt(j));
                    }
                    sum_B += p;
                }
            }

            sum_C = parseInt(sum_A + sum_B) + ""; // Así se convierte en cadena
            sum_D = (10 - parseInt(sum_C.charAt(sum_C.length - 1))) % 10;
            letters = "JABCDEFGHI";

            if (control >= "0" && control <= "9") {
                return control == sum_D;
            } else {
                return control.toUpperCase() == letters[sum_D];
            }
        } else {
            return false;
        }
    }

    /**
     * Check if it is a correct ID (between 5 and 8 letters followed by the corresponding letter).
     * Accept NIEs (Foreigners with X, Y or Z at the beginning)
     * http://trellat.es/funcion-para-validar-dni-o-nie-en-javascript/
     * @param dni
     * @returns {Boolean}
     */
    function isValidDNI(dni) {
        var number, lett, letter;
        var regular_expression_dni = /^[XYZ]?\d{5,8}[A-Z]$/;
        dni = dni.toUpperCase();

        if (regular_expression_dni.test(dni) === true) {
            number = dni.substr(0, dni.length - 1);
            number = number.replace("X", 0);
            number = number.replace("Y", 1);
            number = number.replace("Z", 2);
            lett = dni.substr(dni.length - 1, 1);
            number = number % 23;

            letter = "TRWAGMYFPDXBNJZSQVHLCKET";
            letter = letter.substring(number, number + 1);

            return letter == lett;
        } else {
            return false;
        }
    }

    /**
     * Assign a value to a select field
     * @param select form field element
     * @param value value that the select option must have to be selected
     */
//
    function setSelectValue(select, value) {
        for (var i = 0; i < select.options.length; i++) {
            if (select.options[i].value == value) {
                select.options[i].selected = true;
            } else {
                select.options[i].selected = false;
            }
        }
        // Save the previous value
        select.prev_value = select.options[select.selectedIndex].value;
    }

    /**
     * Select the text of an input text of the form
     * @param input Object from which the text will be selected
     */
    function selectTextInput(input) {
        if (typeof input.setSelectionRange != "undefined") {
            input.setSelectionRange(0, input.value.length);
        }
        input.focus();
    }

    /**
     * Verify that the size of the form attachments does not exceed the size defined in the PHP configuration
     */
    var items;
    var formSizeArray = [];

    var url =
        $("form")
            .attr("action")
            .split("=")[0] + "=stic_Web_Forms_attachment_limits_response";
    $.ajax({
        url: url,
        dataType: "jsonp"
    });

    /**
     * Gets values of the PHP configuration in the system
     * @param data array from which the values ??are obtained
     */
    function getConfigVariables(data) {
        items = data;
        if (!items.uploadMaxFilesize || !items.postMaxSize) {
            alert(stic_Web_Forms_LBL_SERVER_CONNECTION_ERROR);
        }
    }

    /**
     * Check if the attachment file size added to the input file is sizer
     * to the configuration variable php upload_max_filesize
     */
    $(".document").change(function() {
        var numInput = this.id.substring(this.id.length - 1, this.id.length);
        var errorZone = "#error_zone_" + numInput;
        if (this.files[0]) {
            var fileName = this.files[0].name;
            var fileSize = this.files[0].size;
            if (fileSize > items.uploadMaxFilesizeBytes) {
                $(errorZone).html("<span>" + stic_Web_Forms_LBL_SIZE_FILE_EXCEED + items.uploadMaxFilesize + "B </span>");
                formSizeArray[numInput - 1] = fileSize;
            } else {
                $(errorZone).html("");
                formSizeArray[numInput - 1] = fileSize;
            }
        } else {
            $(errorZone).html("");
            formSizeArray[numInput - 1] = 0;
        }
    });

    /**
     * Check the total size of the files attached to the form
     * @returns {Boolean}
     */
    function checkFormSize() {
        if (items) {
            var formSize = 0;
            var fileZizeError = 0;

            formSizeArray.forEach(function(inputSize) {
                if (inputSize) {
                    if (inputSize > items.uploadMaxFilesizeBytes) {
                        fileZizeError = 1;
                    }
                    formSize = formSize + inputSize;
                }
            });

            if (fileZizeError) {
                alert(stic_Web_Forms_LBL_SIZE_FILE_EXCEED + items.uploadMaxFilesize + "B");
                return false;
            }

            if (formSize <= items.postMaxSizeBytes) {
                return true;
            } else {
                alert(stic_Web_Forms_LBL_SUM_SIZE_FILES_EXCEED + items.postMaxSize + "B");
                return false;
            }
        } else {
            return true;
        }
    }

    /**
     * Fills the timeZone variable on loading.
     */
    $('#timeZone').val(Intl.DateTimeFormat().resolvedOptions().timeZone);
    /**
     * Library Code https://github.com/arhs/iban.js
     */
    (function(root, factory) {
        if (typeof define === "function" && define.amd) {
            // AMD. Register as an anonymous module.
            define(["exports"], factory);
        } else if (typeof exports === "object" && typeof exports.nodeName !== "string") {
            // CommonJS
            factory(exports);
        } else {
            // Browser globals
            factory((root.IBAN = {}));
        }
    })(this, function(exports) {
        // Array.prototype.map polyfill
        // Code from https://developer.mozilla.org/en-US/docs/JavaScript/Reference/Global_Objects/Array/map
        if (!Array.prototype.map) {
            Array.prototype.map = function(fun /*, thisArg */) {
                "use strict";
                if (this === void 0 || this === null) {
                    throw new TypeError();
                }

                var t = Object(this);
                var len = t.length >>> 0;
                if (typeof fun !== "function") {
                    throw new TypeError();
                }

                var res = new Array(len);
                var thisArg = arguments.length >= 2 ? arguments[1] : void 0;
                for (var i = 0; i < len; i++) {
                    /*
                      STIC NOTE: Absolute correctness would demand Object.defineProperty be used.  But this method is fairly new, and failure is possible only
                      if Object.prototype or Array.prototype has a property |i| (very unlikely), so use a less-correct but more portable alternative.
                    */
                    if (i in t) {
                        res[i] = fun.call(thisArg, t[i], i, t);
                    }
                }
                return res;
            };
        }

        var A = "A".charCodeAt(0),
            Z = "Z".charCodeAt(0);

        /**
         * Prepare an IBAN for mod 97 computation by moving the first 4 chars to the end and transforming the letters to numbers (A = 10, B = 11,   .., Z = 35), as specified in ISO13616.
         *
         * @param {string} iban the IBAN
         * @returns {string} the prepared IBAN
         */
        function iso13616Prepare(iban) {
            iban = iban.toUpperCase();
            iban = iban.substr(4) + iban.substr(0, 4);
            return iban
                .split("")
                .map(function(n) {
                    var code = n.charCodeAt(0);
                    if (code >= A && code <= Z) {
                        // A = 10, B = 11, ... Z = 35
                        return code - A + 10;
                    } else {
                        return n;
                    }
                })
                .join("");
        }

        /**
         * Calculates the MOD 97 10 of the passed IBAN as specified in ISO7064.
         *
         * @param iban
         * @returns {number}
         */
        function iso7064Mod97_10(iban) {
            var remainder = iban,
                block;

            while (remainder.length > 2) {
                block = remainder.slice(0, 9);
                remainder = (parseInt(block, 10) % 97) + remainder.slice(block.length);
            }

            return parseInt(remainder, 10) % 97;
        }

        /**
         * Parse the BBAN structure used to configure each IBAN Specification and returns a matching regular expression.
         * A structure is composed of blocks of 3 characters (one letter and 2 digits). Each block represents
         * a logical group in the typical representation of the BBAN. For each group, the letter indicates which characters
         * are allowed in this group and the following 2-digits number tells the length of the group.
         *
         * @param {string} structure the structure to parse
         * @returns {RegExp}
         */
        function parseStructure(structure) {
            // split in blocks of 3 chars
            var regex = structure.match(/(.{3})/g).map(function(block) {
                // parse each structure block (1-char + 2-digits)
                var format,
                    pattern = block.slice(0, 1),
                    repeats = parseInt(block.slice(1), 10);

                switch (pattern) {
                    case "A":
                        format = "0-9A-Za-z";
                        break;
                    case "B":
                        format = "0-9A-Z";
                        break;
                    case "C":
                        format = "A-Za-z";
                        break;
                    case "F":
                        format = "0-9";
                        break;
                    case "L":
                        format = "a-z";
                        break;
                    case "U":
                        format = "A-Z";
                        break;
                    case "W":
                        format = "0-9a-z";
                        break;
                }
                return "([" + format + "]{" + repeats + "})";
            });
            return new RegExp("^" + regex.join("") + "$");
        }

        /**
         * @param iban
         * @returns {string}
         */
        function electronicFormat(iban) {
            return iban.replace(NON_ALPHANUM, "").toUpperCase();
        }

        /**
         * Create a new Specification for a valid IBAN number.
         *
         * @param countryCode the code of the country
         * @param length the length of the IBAN
         * @param structure the structure of the underlying BBAN (for validation and formatting)
         * @param example an example valid IBAN
         * @constructor
         */
        function Specification(countryCode, length, structure, example) {
            this.countryCode = countryCode;
            this.length = length;
            this.structure = structure;
            this.example = example;
        }

        /**
         * Lazy-loaded regex (parse the structure and construct the regular expression the first time we need it for validation)
         */
        Specification.prototype._regex = function() {
            return this._cachedRegex || (this._cachedRegex = parseStructure(this.structure));
        };

        /**
         * Check if the passed iban is valid according to this specification.
         *
         * @param {String} iban the iban to validate
         * @returns {boolean} true if valid, false otherwise
         */
        Specification.prototype.isValid = function(iban) {
            return this.length == iban.length && this.countryCode === iban.slice(0, 2) && this._regex().test(iban.slice(4)) && iso7064Mod97_10(iso13616Prepare(iban)) == 1;
        };

        /**
         * Convert the passed IBAN to a country-specific BBAN.
         *
         * @param iban the IBAN to convert
         * @param separator the separator to use between BBAN blocks
         * @returns {string} the BBAN
         */
        Specification.prototype.toBBAN = function(iban, separator) {
            return this._regex()
                .exec(iban.slice(4))
                .slice(1)
                .join(separator);
        };

        /**
         * Convert the passed BBAN to an IBAN for this country specification.
         * Please note that <i>"generation of the IBAN shall be the exclusive responsibility of the bank/branch servicing the account"</i>.
         * This method implements the preferred algorithm described in http://en.wikipedia.org/wiki/International_Bank_Account_Number#Generating_IBAN_check_digits
         *
         * @param bban the BBAN to convert to IBAN
         * @returns {string} the IBAN
         */
        Specification.prototype.fromBBAN = function(bban) {
            if (!this.isValidBBAN(bban)) {
                throw new Error("Invalid BBAN");
            }
            var remainder = iso7064Mod97_10(iso13616Prepare(this.countryCode + "00" + bban)),
                checkDigit = ("0" + (98 - remainder)).slice(-2);

            return this.countryCode + checkDigit + bban;
        };

        /**
         * Check of the passed BBAN is valid.
         * This function only checks the format of the BBAN (length and matching the letetr/number specs) but does not
         * verify the check digit.
         *
         * @param bban the BBAN to validate
         * @returns {boolean} true if the passed bban is a valid BBAN according to this specification, false otherwise
         */
        Specification.prototype.isValidBBAN = function(bban) {
            return this.length - 4 == bban.length && this._regex().test(bban);
        };

        var countries = {};
        function addSpecification(IBAN) {
            countries[IBAN.countryCode] = IBAN;
        }

        addSpecification(new Specification("AD", 24, "F04F04A12", "AD1200012030200359100100"));
        addSpecification(new Specification("AE", 23, "F03F16", "AE070331234567890123456"));
        addSpecification(new Specification("AL", 28, "F08A16", "AL47212110090000000235698741"));
        addSpecification(new Specification("AT", 20, "F05F11", "AT611904300234573201"));
        addSpecification(new Specification("AZ", 28, "U04A20", "AZ21NABZ00000000137010001944"));
        addSpecification(new Specification("BA", 20, "F03F03F08F02", "BA391290079401028494"));
        addSpecification(new Specification("BE", 16, "F03F07F02", "BE68539007547034"));
        addSpecification(new Specification("BG", 22, "U04F04F02A08", "BG80BNBG96611020345678"));
        addSpecification(new Specification("BH", 22, "U04A14", "BH67BMAG00001299123456"));
        addSpecification(new Specification("BR", 29, "F08F05F10U01A01", "BR9700360305000010009795493P1"));
        addSpecification(new Specification("BY", 28, "A04F04A16", "BY13NBRB3600900000002Z00AB00"));
        addSpecification(new Specification("CH", 21, "F05A12", "CH9300762011623852957"));
        addSpecification(new Specification("CR", 22, "F04F14", "CR72012300000171549015"));
        addSpecification(new Specification("CY", 28, "F03F05A16", "CY17002001280000001200527600"));
        addSpecification(new Specification("CZ", 24, "F04F06F10", "CZ6508000000192000145399"));
        addSpecification(new Specification("DE", 22, "F08F10", "DE89370400440532013000"));
        addSpecification(new Specification("DK", 18, "F04F09F01", "DK5000400440116243"));
        addSpecification(new Specification("DO", 28, "U04F20", "DO28BAGR00000001212453611324"));
        addSpecification(new Specification("EE", 20, "F02F02F11F01", "EE382200221020145685"));
        addSpecification(new Specification("ES", 24, "F04F04F01F01F10", "ES9121000418450200051332"));
        addSpecification(new Specification("FI", 18, "F06F07F01", "FI2112345600000785"));
        addSpecification(new Specification("FO", 18, "F04F09F01", "FO6264600001631634"));
        addSpecification(new Specification("FR", 27, "F05F05A11F02", "FR1420041010050500013M02606"));
        addSpecification(new Specification("GB", 22, "U04F06F08", "GB29NWBK60161331926819"));
        addSpecification(new Specification("GE", 22, "U02F16", "GE29NB0000000101904917"));
        addSpecification(new Specification("GI", 23, "U04A15", "GI75NWBK000000007099453"));
        addSpecification(new Specification("GL", 18, "F04F09F01", "GL8964710001000206"));
        addSpecification(new Specification("GR", 27, "F03F04A16", "GR1601101250000000012300695"));
        addSpecification(new Specification("GT", 28, "A04A20", "GT82TRAJ01020000001210029690"));
        addSpecification(new Specification("HR", 21, "F07F10", "HR1210010051863000160"));
        addSpecification(new Specification("HU", 28, "F03F04F01F15F01", "HU42117730161111101800000000"));
        addSpecification(new Specification("IE", 22, "U04F06F08", "IE29AIBK93115212345678"));
        addSpecification(new Specification("IL", 23, "F03F03F13", "IL620108000000099999999"));
        addSpecification(new Specification("IS", 26, "F04F02F06F10", "IS140159260076545510730339"));
        addSpecification(new Specification("IT", 27, "U01F05F05A12", "IT60X0542811101000000123456"));
        addSpecification(new Specification("IQ", 23, "U04F03A12", "IQ98NBIQ850123456789012"));
        addSpecification(new Specification("JO", 30, "A04F22", "JO15AAAA1234567890123456789012"));
        addSpecification(new Specification("KW", 30, "U04A22", "KW81CBKU0000000000001234560101"));
        addSpecification(new Specification("KZ", 20, "F03A13", "KZ86125KZT5004100100"));
        addSpecification(new Specification("LB", 28, "F04A20", "LB62099900000001001901229114"));
        addSpecification(new Specification("LC", 32, "U04F24", "LC07HEMM000100010012001200013015"));
        addSpecification(new Specification("LI", 21, "F05A12", "LI21088100002324013AA"));
        addSpecification(new Specification("LT", 20, "F05F11", "LT121000011101001000"));
        addSpecification(new Specification("LU", 20, "F03A13", "LU280019400644750000"));
        addSpecification(new Specification("LV", 21, "U04A13", "LV80BANK0000435195001"));
        addSpecification(new Specification("MC", 27, "F05F05A11F02", "MC5811222000010123456789030"));
        addSpecification(new Specification("MD", 24, "U02A18", "MD24AG000225100013104168"));
        addSpecification(new Specification("ME", 22, "F03F13F02", "ME25505000012345678951"));
        addSpecification(new Specification("MK", 19, "F03A10F02", "MK07250120000058984"));
        addSpecification(new Specification("MR", 27, "F05F05F11F02", "MR1300020001010000123456753"));
        addSpecification(new Specification("MT", 31, "U04F05A18", "MT84MALT011000012345MTLCAST001S"));
        addSpecification(new Specification("MU", 30, "U04F02F02F12F03U03", "MU17BOMM0101101030300200000MUR"));
        addSpecification(new Specification("NL", 18, "U04F10", "NL91ABNA0417164300"));
        addSpecification(new Specification("NO", 15, "F04F06F01", "NO9386011117947"));
        addSpecification(new Specification("PK", 24, "U04A16", "PK36SCBL0000001123456702"));
        addSpecification(new Specification("PL", 28, "F08F16", "PL61109010140000071219812874"));
        addSpecification(new Specification("PS", 29, "U04A21", "PS92PALS000000000400123456702"));
        addSpecification(new Specification("PT", 25, "F04F04F11F02", "PT50000201231234567890154"));
        addSpecification(new Specification("QA", 29, "U04A21", "QA30AAAA123456789012345678901"));
        addSpecification(new Specification("RO", 24, "U04A16", "RO49AAAA1B31007593840000"));
        addSpecification(new Specification("RS", 22, "F03F13F02", "RS35260005601001611379"));
        addSpecification(new Specification("SA", 24, "F02A18", "SA0380000000608010167519"));
        addSpecification(new Specification("SC", 31, "U04F04F16U03", "SC18SSCB11010000000000001497USD"));
        addSpecification(new Specification("SE", 24, "F03F16F01", "SE4550000000058398257466"));
        addSpecification(new Specification("SI", 19, "F05F08F02", "SI56263300012039086"));
        addSpecification(new Specification("SK", 24, "F04F06F10", "SK3112000000198742637541"));
        addSpecification(new Specification("SM", 27, "U01F05F05A12", "SM86U0322509800000000270100"));
        addSpecification(new Specification("ST", 25, "F08F11F02", "ST68000100010051845310112"));
        addSpecification(new Specification("SV", 28, "U04F20", "SV62CENR00000000000000700025"));
        addSpecification(new Specification("TL", 23, "F03F14F02", "TL380080012345678910157"));
        addSpecification(new Specification("TN", 24, "F02F03F13F02", "TN5910006035183598478831"));
        addSpecification(new Specification("TR", 26, "F05F01A16", "TR330006100519786457841326"));
        addSpecification(new Specification("UA", 29, "F25", "UA511234567890123456789012345"));
        addSpecification(new Specification("VG", 24, "U04F16", "VG96VPVG0000012345678901"));
        addSpecification(new Specification("XK", 20, "F04F10F02", "XK051212012345678906"));
        // The following countries are not included in the official IBAN registry but use the IBAN specification
        // Angola
        addSpecification(new Specification("AO", 25, "F21", "AO69123456789012345678901"));
        // Burkina
        addSpecification(new Specification("BF", 27, "F23", "BF2312345678901234567890123"));
        // Burundi
        addSpecification(new Specification("BI", 16, "F12", "BI41123456789012"));
        // Benin
        addSpecification(new Specification("BJ", 28, "F24", "BJ39123456789012345678901234"));
        // Ivory
        addSpecification(new Specification("CI", 28, "U01F23", "CI17A12345678901234567890123"));
        // Cameron
        addSpecification(new Specification("CM", 27, "F23", "CM9012345678901234567890123"));
        // Cape Verde
        addSpecification(new Specification("CV", 25, "F21", "CV30123456789012345678901"));
        // Algeria
        addSpecification(new Specification("DZ", 24, "F20", "DZ8612345678901234567890"));
        // Iran
        addSpecification(new Specification("IR", 26, "F22", "IR861234568790123456789012"));
        // Madagascar
        addSpecification(new Specification("MG", 27, "F23", "MG1812345678901234567890123"));
        // Mali
        addSpecification(new Specification("ML", 28, "U01F23", "ML15A12345678901234567890123"));
        // Mozambique
        addSpecification(new Specification("MZ", 25, "F21", "MZ25123456789012345678901"));
        // Senegal
        addSpecification(new Specification("SN", 28, "U01F23", "SN52A12345678901234567890123"));

        var NON_ALPHANUM = /[^a-zA-Z0-9]/g,
            EVERY_FOUR_CHARS = /(.{4})(?!$)/g;

        /**
         * Utility function to check if a variable is a String.
         *
         * @param v
         * @returns {boolean} true if the passed variable is a String, false otherwise.
         */
        function isString(v) {
            return typeof v == "string" || v instanceof String;
        }

        /**
         * Check if an IBAN is valid.
         *
         * @param {String} iban the IBAN to validate.
         * @returns {boolean} true if the passed IBAN is valid, false otherwise
         */
        exports.isValid = function(iban) {
            if (!isString(iban)) {
                return false;
            }
            iban = electronicFormat(iban);
            var countryStructure = countries[iban.slice(0, 2)];
            return !!countryStructure && countryStructure.isValid(iban);
        };

        /**
         * Convert an IBAN to a BBAN.
         *
         * @param iban
         * @param {String} [separator] the separator to use between the blocks of the BBAN, defaults to ' '
         * @returns {string|*}
         */
        exports.toBBAN = function(iban, separator) {
            if (typeof separator == "undefined") {
                separator = " ";
            }

            iban = electronicFormat(iban);
            var countryStructure = countries[iban.slice(0, 2)];
            if (!countryStructure) {
                throw new Error("No country with code " + iban.slice(0, 2));
            }

            return countryStructure.toBBAN(iban, separator);
        };

        /**
         * Convert the passed BBAN to an IBAN for this country specification.
         * Please note that <i>"generation of the IBAN shall be the exclusive responsibility of the bank/branch servicing the account"</i>.
         * This method implements the preferred algorithm described in http://en.wikipedia.org/wiki/International_Bank_Account_Number#Generating_IBAN_check_digits
         *
         * @param countryCode the country of the BBAN
         * @param bban the BBAN to convert to IBAN
         * @returns {string} the IBAN
         */
        exports.fromBBAN = function(countryCode, bban) {
            var countryStructure = countries[countryCode];
            if (!countryStructure) {
                throw new Error("No country with code " + countryCode);
            }
            return countryStructure.fromBBAN(electronicFormat(bban));
        };

        /**
         * Check the validity of the passed BBAN.
         *
         * @param countryCode the country of the BBAN
         * @param bban the BBAN to check the validity of
         */
        exports.isValidBBAN = function(countryCode, bban) {
            if (!isString(bban)) {
                return false;
            }
            var countryStructure = countries[countryCode];
            return countryStructure && countryStructure.isValidBBAN(electronicFormat(bban));
        };

        /**
         *
         * @param iban
         * @param separator
         * @returns {string}
         */
        exports.printFormat = function(iban, separator) {
            if (typeof separator == "undefined") {
                separator = " ";
            }
            return electronicFormat(iban).replace(EVERY_FOUR_CHARS, "$1" + separator);
        };
        exports.electronicFormat = electronicFormat;

        /**
         * An object containing all the known IBAN specifications.
         */
        exports.countries = countries;
    });

    /**
     * Validate IBAN
     * @returns {Boolean}
     */
    function validateIBAN() {
        // v2018
        // If the payment method is not direct debit, the IBAN must not be validated
        if (document.getElementById("stic_Payment_Commitments___payment_method").value == "direct_debit") {
            var bankAccount = document.getElementById("stic_Payment_Commitments___bank_account");
            bankAccount.value = bankAccount.value.toUpperCase();
            if (bankAccount == null) {
                // If there is no account number it will give error
                return false;
            } else {
                if (!IBAN.isValid(bankAccount.value)) {
                    alert(stic_Payment_Commitments_LBL_IBAN_NOT_VALID);
                    selectTextInput(bankAccount);
                    return false;
                }
            }
        }
        return true;
    }
    /**
     * Overload the data validation function to include the validation of the payment methods fields
     */
    (function() {
        var tmpCheckFields = checkFields;
        checkFields = function() {
            if (tmpCheckFields) {
                return tmpCheckFields() && validateIBAN();
            }
            return validateIBAN();
        };
    })();

    /**
     * Adapt the form based on the value of the payment method
     */
    function adaptPaymentMethod(oPaymentMethod) {
        // Retrieve the html element of payment method
        var vPaymentMethod = oPaymentMethod.options[oPaymentMethod.selectedIndex].value;

        // If the payment method is a direct debit, it shows the account number field and marks it as required.
        if (vPaymentMethod == "direct_debit") {
            showField("stic_Payment_Commitments___bank_account");
            addRequired("stic_Payment_Commitments___bank_account");
        } else {
            hideField("stic_Payment_Commitments___bank_account");
            removeRequired("stic_Payment_Commitments___bank_account");
        }
        oPaymentMethod.prev_value = vPaymentMethod;
    }


    var formHasAlreadyBeenSent = false;
/**
 * Form submission function
 * @param form form to be sent
 */
function submitForm(form) {
  if (checkFields() && checkFormSize()) {
    if (formHasAlreadyBeenSent !== true) {
        formHasAlreadyBeenSent = true;
        form.submit();
    } else {
        console.log("El formulari ja s'ha enviat.");
        alert("El formulari ja s'ha enviat. Si us plau, espereu.");
    }
  }
  return false;
}


document.addEventListener("DOMContentLoaded", function() {
  let submitButton = document.getElementById("submit-button");
  let turnstileTokenInput = document.getElementById("cf-turnstile-token");

  // Funció per activar/desactivar el botó d'enviar
  function toggleSubmitButton(enable) {
      if (enable) {
          submitButton.removeAttribute("disabled");
      } else {
          submitButton.setAttribute("disabled", "true");
      }
  }

  // Desactivar el botó per defecte
  toggleSubmitButton(false);

  // Listener per quan Cloudflare Turnstile generi un token
  window.onloadTurnstileCallback = function() {
      turnstile.render('.cf-turnstile', {
          sitekey: "0x4AAAAAABgvZbG5L-aBdqvF",
          callback: function(token) {
              if (token) {
                  turnstileTokenInput.value = token; 
                  toggleSubmitButton(true); 
              } else {
                  toggleSubmitButton(false); 
              }
          }
      });
  };
});

</script>
<script>
document.addEventListener('DOMContentLoaded', async function () {
  const hiddenInput = document.getElementById('stic_Payment_Commitments___amount');
  const customAmount = document.getElementById('custom-amount');
  let isComposing = false;

  // Traduccions i placeholder
  const urlParams = new URLSearchParams(window.location.search);
  const lang = urlParams.get('lang') || localStorage.getItem('selectedLang') || 'cat';
  try {
    const response = await fetch('/assets/translations.json');
    const translations = await response.json();
    const dict = translations[lang];
    localStorage.setItem('selectedLang', lang);

    const key = customAmount.getAttribute('data-i18n-placeholder');
    if (dict[key]) {
      customAmount.setAttribute('data-placeholder', dict[key]);
    }
  } catch (e) {
    console.warn('Error carregant traduccions:', e);
  }

  // Placeholder
  function updatePlaceholderVisibility() {
    const isEmpty = customAmount.textContent.trim() === '';
    const hasPlaceholder = customAmount.getAttribute('data-placeholder');

    if (isEmpty && hasPlaceholder) {
      customAmount.textContent = hasPlaceholder;
      customAmount.classList.add('placeholder-visible');
      customAmount.setAttribute('data-showing-placeholder', 'true');
    }
  }

  function removePlaceholderIfPresent() {
    if (customAmount.getAttribute('data-showing-placeholder') === 'true') {
      customAmount.textContent = '';
      customAmount.classList.remove('placeholder-visible');
      customAmount.removeAttribute('data-showing-placeholder');
    }
  }

  updatePlaceholderVisibility();

  // Gestió de botons d'import
  function clearActiveButtons() {
    document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('active'));
  }

  function setCustomActive(active) {
    if (active) {
      customAmount.classList.add('active');
    } else {
      customAmount.classList.remove('active');
    }
  }

  document.querySelectorAll('.amount-btn').forEach(button => {
    button.addEventListener('click', () => {
      clearActiveButtons();
      setCustomActive(false);

      button.classList.add('active');
      hiddenInput.value = button.dataset.amount;
      customAmount.textContent = '';
      updatePlaceholderVisibility();
    });
  });

  // Gestió del camp editable
  customAmount.addEventListener('focus', () => {
    removePlaceholderIfPresent();
    clearActiveButtons();
    setCustomActive(true);
  });

  customAmount.addEventListener('blur', () => {
    if (customAmount.textContent.trim() === '') {
      updatePlaceholderVisibility();
    }
  });

  customAmount.addEventListener('compositionstart', () => { isComposing = true; });
  customAmount.addEventListener('compositionend', () => { isComposing = false; });

  customAmount.addEventListener('input', () => {
    if (isComposing) return;

    if (customAmount.getAttribute('data-showing-placeholder') === 'true') {
      removePlaceholderIfPresent();
    }

    let raw = customAmount.textContent.replace(/[^\d.,]/g, '').replace(',', '.').trim();
    clearActiveButtons();

    if (raw && !isNaN(raw) && Number(raw) > 0) {
      hiddenInput.value = raw;
      setCustomActive(true);
    } else {
      hiddenInput.value = '';
      setCustomActive(false);
    }
  });
});
</script>


<script type="text/javascript" src="https://sinergia.iridia.cat/cache/include/javascript/sugar_grp1_jquery.js?v=Baq42U_JXBGKim0eG6gfYw"></script>
<script type="text/javascript" src="https://sinergia.iridia.cat/cache/include/javascript/sugar_grp1_yui.js?v=Baq42U_JXBGKim0eG6gfYw"></script>
<script type="text/javascript" src="https://sinergia.iridia.cat/cache/include/javascript/sugar_grp1.js?v=Baq42U_JXBGKim0eG6gfYw"></script>

</body>
</html>